<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ácaros | Admin</title>

  <link rel="stylesheet" href="assets/css/styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">Monitoreo Ácaros</div>
    <nav class="nav">
      <a href="index.html">Dashboard</a>
      <a href="exceles.html">Cargar Excel/CSV</a>
      <a href="informes.html">Informes</a>
      <a class="active" href="admin.html">Admin</a>
      <a href="login.html" id="btnLogoutLink">Salir</a>
    </nav>
  </header>

  <main class="container">
    <section class="panel">
      <h1>Admin</h1>
      <div class="hint" id="roleHint">Cargando rol...</div>

      <div class="filters" style="grid-template-columns: 180px 180px 180px 1fr;">
        <label>
          Sección
          <select id="sectionSelect">
            <option value="catalogos" selected>Catálogos</option>
            <option value="cargas">Cargas (uploads)</option>
          </select>
        </label>

        <label>
          Finca (para bloques)
          <select id="fincaFilter"></select>
        </label>

        <label>
          Acciones rápidas
          <button id="btnReload" class="btn btnLight">Recargar</button>
        </label>

        <div id="status" class="status"></div>
      </div>
    </section>

    <!-- ===================== -->
    <!-- Catálogos -->
    <!-- ===================== -->
    <section class="panel" id="secCatalogos">
      <div class="grid2" style="grid-template-columns: 1fr 1fr;">
        <section class="panel">
          <h2>Fincas</h2>

          <div class="filters" style="grid-template-columns: 1fr 140px;">
            <label>Nombre
              <input id="newFincaNombre" type="text" placeholder="Bogaert" />
            </label>
            <button id="btnCreateFinca" class="btn">Crear</button>
          </div>

          <div class="tableWrap" style="margin-top:10px;">
            <table class="table" id="fTbl">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Nombre</th>
                  <th>GeoJSON</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <div class="hint">Borrar fincas solo estará habilitado para owner.</div>
        </section>

        <section class="panel">
          <h2>Bloques</h2>

          <div class="filters" style="grid-template-columns: 1fr 1fr 140px;">
            <label>Finca
              <select id="newBloqueFinca"></select>
            </label>
            <label>Nombre bloque
              <input id="newBloqueNombre" type="text" placeholder="Bloque 1" />
            </label>
            <button id="btnCreateBloque" class="btn">Crear</button>

            <label>Plantas total
              <input id="newBloquePlantas" type="number" min="0" />
            </label>
            <label>% (ej 44.9)
              <input id="newBloquePct" type="number" step="0.1" min="0" />
            </label>
            <label>Muestreo
              <input id="newBloqueMuestreo" type="number" min="0" />
            </label>
          </div>

          <div class="tableWrap" style="margin-top:10px;">
            <table class="table" id="bTbl">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Finca</th>
                  <th>Bloque</th>
                  <th>Plantas</th>
                  <th>%</th>
                  <th>Muestreo</th>
                  <th>Acciones</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>

          <div class="hint">Borrar bloques solo estará habilitado para owner.</div>
        </section>
      </div>

      <section class="panel">
        <h2>GeoJSON por finca</h2>
        <div class="filters" style="grid-template-columns: 1fr 140px;">
          <label>Finca
            <select id="geoFincaSelect"></select>
          </label>
          <button id="btnSaveGeojson" class="btn">Guardar GeoJSON</button>
        </div>

        <label style="margin-top:10px;">
          GeoJSON (pega un Feature/Polygon válido)
          <textarea id="geojsonText" rows="10" style="width:100%; padding:10px; border-radius:10px; border:1px solid rgba(255,255,255,.1); background:rgba(255,255,255,.06); color:#e7eefc;"></textarea>
        </label>
        <div class="hint">Sugerencia: guarda 1 Feature por finca y que `properties.name` coincida con el nombre.</div>
      </section>
    </section>

    <!-- ===================== -->
    <!-- Cargas (uploads) -->
    <!-- ===================== -->
    <section class="panel" id="secCargas" style="display:none;">
      <h2>Historial de cargas</h2>
      <div class="hint">Eliminar una carga borra los monitoreos asociados mediante RPC delete_upload.</div>

      <div class="tableWrap" style="margin-top:10px;">
        <table class="table" id="uTbl">
          <thead>
            <tr>
              <th>ID</th>
              <th>Fecha</th>
              <th>Archivo</th>
              <th>Status</th>
              <th>Total</th>
              <th>Válidas</th>
              <th>Inválidas</th>
              <th>Subido por</th>
              <th>Acciones</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>
  </main>

  <script type="module" src="assets/js/admin.js"></script>
</body>
</html>

